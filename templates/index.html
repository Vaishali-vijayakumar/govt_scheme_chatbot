<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyScheme Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .scheme-card {
            transition: transform 0.2s;
            margin-bottom: 20px;
            height: 100%;
        }
        
        .scheme-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .card-img-top {
            height: 180px;
            object-fit: cover;
        }
        
        .application-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        #main-content {
            min-height: 70vh;
        }
        
        footer {
            background-color: #343a40;
            color: white;
            padding: 20px 0;
            margin-top: 50px;
        }
        
        /* Custom modal width for application form */
        .modal-xl {
            max-width: 800px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="loadHomePage()">MyScheme Portal</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadHomePage()">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadAllSchemes()">All Schemes</a>
                    </li>
                    <li class="nav-item" id="dashboard-nav" style="display: none;">
                        <a class="nav-link" href="#" onclick="loadDashboard()">Dashboard</a>
                    </li>
                    <li class="nav-item" id="admin-nav" style="display: none;">
                        <a class="nav-link" href="#" onclick="loadAdminPanel()">Admin Panel</a>
                    </li>
                </ul>
                <div class="d-flex" id="auth-buttons">
                    <button class="btn btn-light me-2" onclick="showLoginModal()">Login</button>
                    <button class="btn btn-outline-light" onclick="showRegisterModal()">Register</button>
                </div>
                <div class="d-flex" id="user-info" style="display: none;">
                    <span class="navbar-text me-3" id="username-display"></span>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4" id="main-content">
        <!-- Content will be dynamically loaded here -->
        <div id="home-page">
            <h1>Welcome to MyScheme Portal</h1>
            <p>Browse and apply for government schemes in one place.</p>
            <div class="row" id="featured-schemes">
                <!-- Featured schemes will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Auth Modals -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="mb-3">
                            <label for="login-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="login-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="login-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="login-password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Login</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Register</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="register-form">
                        <div class="mb-3">
                            <label for="register-name" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="register-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="register-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="register-password" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-aadhar" class="form-label">Aadhar Number</label>
                            <input type="text" class="form-control" id="register-aadhar" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-phone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="register-phone" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Register</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Modal -->
    <div class="modal fade" id="applicationModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="applicationModalTitle">Apply for Scheme</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="applicationModalBody">
                    <!-- Application form will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Modals -->
    <div class="modal fade" id="addSchemeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Scheme</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-scheme-form">
                        <div class="mb-3">
                            <label for="scheme-name" class="form-label">Scheme Name</label>
                            <input type="text" class="form-control" id="scheme-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="scheme-description" class="form-label">Description</label>
                            <textarea class="form-control" id="scheme-description" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="scheme-eligibility" class="form-label">Eligibility (one per line)</label>
                            <textarea class="form-control" id="scheme-eligibility" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="scheme-benefits" class="form-label">Benefits (one per line)</label>
                            <textarea class="form-control" id="scheme-benefits" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="scheme-documents" class="form-label">Documents Required (one per line)</label>
                            <textarea class="form-control" id="scheme-documents" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="scheme-link" class="form-label">Official Link (optional)</label>
                            <input type="url" class="form-control" id="scheme-link">
                        </div>
                        <button type="submit" class="btn btn-primary">Add Scheme</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center">
        <div class="container">
            <p>&copy; 2023 MyScheme Portal. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // API Base URL
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // DOM Elements
        const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
        const registerModal = new bootstrap.Modal(document.getElementById('registerModal'));
        const applicationModal = new bootstrap.Modal(document.getElementById('applicationModal'));
        const addSchemeModal = new bootstrap.Modal(document.getElementById('addSchemeModal'));
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            
            // Set up form event listeners
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleRegister);
            document.getElementById('add-scheme-form').addEventListener('submit', handleAddScheme);
            
            // Load home page by default
            loadHomePage();
        });
        
        // Authentication Functions
        function checkAuthStatus() {
            const token = localStorage.getItem('token');
            const authButtons = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            const dashboardNav = document.getElementById('dashboard-nav');
            const adminNav = document.getElementById('admin-nav');
            
            if (token) {
                authButtons.style.display = 'none';
                userInfo.style.display = 'flex';
                
                // Get user info from token
                const userData = JSON.parse(atob(token.split('.')[1]));
                document.getElementById('username-display').textContent = userData.identity.name || 'User';
                
                dashboardNav.style.display = 'block';
                
                if (userData.identity.role === 'admin') {
                    adminNav.style.display = 'block';
                }
            } else {
                authButtons.style.display = 'flex';
                userInfo.style.display = 'none';
                dashboardNav.style.display = 'none';
                adminNav.style.display = 'none';
            }
        }
        
        function showLoginModal() {
            loginModal.show();
        }
        
        function showRegisterModal() {
            registerModal.show();
        }
        
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            fetch(`${API_BASE_URL}/auth/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Login failed');
                }
                return response.json();
            })
            .then(data => {
                localStorage.setItem('token', data.token);
                loginModal.hide();
                checkAuthStatus();
                loadHomePage();
            })
            .catch(error => {
                alert('Login failed. Please check your credentials.');
                console.error('Login error:', error);
            });
        }
        
        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const aadhar = document.getElementById('register-aadhar').value;
            const phone = document.getElementById('register-phone').value;
            
            fetch(`${API_BASE_URL}/auth/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email, password, aadhar, phone })
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => { throw new Error(err.error || 'Registration failed'); });
                }
                return response.json();
            })
            .then(data => {
                localStorage.setItem('token', data.token);
                registerModal.hide();
                checkAuthStatus();
                loadHomePage();
            })
            .catch(error => {
                alert(error.message || 'Registration failed. Please try again.');
                console.error('Registration error:', error);
            });
        }
        
        function logout() {
            localStorage.removeItem('token');
            checkAuthStatus();
            loadHomePage();
        }
        
        // Page Loading Functions
        function loadHomePage() {
            fetch(`${API_BASE_URL}/schemes`)
                .then(response => response.json())
                .then(schemes => {
                    const featuredContainer = document.getElementById('featured-schemes');
                    featuredContainer.innerHTML = '';
                    
                    // Show first 3 schemes as featured
                    const featured = schemes.slice(0, 3);
                    
                    featured.forEach(scheme => {
                        const card = document.createElement('div');
                        card.className = 'col-md-4';
                        card.innerHTML = `
                            <div class="card scheme-card">
                                <div class="card-body">
                                    <h5 class="card-title">${scheme.name}</h5>
                                    <p class="card-text">${scheme.description.substring(0, 100)}...</p>
                                    <a href="#" class="btn btn-primary" onclick="viewScheme('${scheme.id}')">View Details</a>
                                </div>
                            </div>
                        `;
                        featuredContainer.appendChild(card);
                    });
                    
                    document.getElementById('main-content').innerHTML = document.getElementById('home-page').innerHTML;
                })
                .catch(error => {
                    console.error('Error loading schemes:', error);
                    document.getElementById('main-content').innerHTML = `
                        <div class="alert alert-danger">Error loading schemes. Please try again later.</div>
                    `;
                });
        }
        
        function loadAllSchemes() {
            fetch(`${API_BASE_URL}/schemes`)
                .then(response => response.json())
                .then(schemes => {
                    const content = `
                        <h1>All Government Schemes</h1>
                        <div class="row" id="schemes-list">
                            ${schemes.map(scheme => `
                                <div class="col-md-4 mb-4">
                                    <div class="card scheme-card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">${scheme.name}</h5>
                                            <p class="card-text">${scheme.description.substring(0, 100)}...</p>
                                            <div class="mt-3">
                                                <a href="#" class="btn btn-primary me-2" onclick="viewScheme('${scheme.id}')">View Details</a>
                                                <a href="#" class="btn btn-success" onclick="applyForScheme('${scheme.id}')">Apply Now</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    document.getElementById('main-content').innerHTML = content;
                })
                .catch(error => {
                    console.error('Error loading schemes:', error);
                    document.getElementById('main-content').innerHTML = `
                        <div class="alert alert-danger">Error loading schemes. Please try again later.</div>
                    `;
                });
        }
        
        function viewScheme(schemeId) {
            fetch(`${API_BASE_URL}/schemes/${schemeId}`)
                .then(response => response.json())
                .then(scheme => {
                    const content = `
                        <div class="card">
                            <div class="card-body">
                                <h2 class="card-title">${scheme.name}</h2>
                                <p class="card-text">${scheme.description}</p>
                                
                                <h4 class="mt-4">Eligibility Criteria</h4>
                                <ul>
                                    ${scheme.eligibility.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                                
                                <h4 class="mt-4">Benefits</h4>
                                <ul>
                                    ${scheme.benefits.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                                
                                <h4 class="mt-4">Documents Required</h4>
                                <ul>
                                    ${scheme.documentsRequired.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                                
                                ${scheme.link ? `<a href="${scheme.link}" class="btn btn-info mt-3" target="_blank">Official Website</a>` : ''}
                                
                                <div class="mt-4">
                                    <button class="btn btn-primary" onclick="applyForScheme('${scheme.id}')">Apply Now</button>
                                    <button class="btn btn-secondary ms-2" onclick="loadAllSchemes()">Back to Schemes</button>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('main-content').innerHTML = content;
                })
                .catch(error => {
                    console.error('Error loading scheme:', error);
                    document.getElementById('main-content').innerHTML = `
                        <div class="alert alert-danger">Error loading scheme details. Please try again later.</div>
                    `;
                });
        }
        
        function applyForScheme(schemeId) {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login to apply for schemes');
                showLoginModal();
                return;
            }
            
            fetch(`${API_BASE_URL}/schemes/${schemeId}`)
                .then(response => response.json())
                .then(scheme => {
                    document.getElementById('applicationModalTitle').textContent = `Apply for ${scheme.name}`;
                    
                    const formHtml = `
                        <form id="scheme-application-form" enctype="multipart/form-data">
                            <input type="hidden" name="schemeId" value="${schemeId}">
                            
                            ${scheme.documentsRequired.map((doc, index) => `
                                <div class="mb-3">
                                    <label for="doc-${index}" class="form-label">${doc}</label>
                                    <input type="file" class="form-control" id="doc-${index}" name="files" required>
                                </div>
                            `).join('')}
                            
                            <div class="mb-3">
                                <label for="additional-info" class="form-label">Additional Information</label>
                                <textarea class="form-control" id="additional-info" name="answers" rows="3"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Submit Application</button>
                            <button type="button" class="btn btn-secondary ms-2" data-bs-dismiss="modal">Cancel</button>
                        </form>
                    `;
                    
                    document.getElementById('applicationModalBody').innerHTML = formHtml;
                    applicationModal.show();
                    
                    document.getElementById('scheme-application-form').addEventListener('submit', function(e) {
                        e.preventDefault();
                        submitApplication(schemeId);
                    });
                })
                .catch(error => {
                    console.error('Error loading scheme:', error);
                    alert('Error loading scheme details. Please try again.');
                });
        }
        
        function submitApplication(schemeId) {
            const form = document.getElementById('scheme-application-form');
            const formData = new FormData(form);
            
            fetch(`${API_BASE_URL}/applications`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Application submission failed');
                }
                return response.json();
            })
            .then(data => {
                applicationModal.hide();
                alert('Application submitted successfully!');
                loadDashboard();
            })
            .catch(error => {
                console.error('Error submitting application:', error);
                alert('Error submitting application. Please try again.');
            });
        }
        
        function loadDashboard() {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login to view dashboard');
                showLoginModal();
                return;
            }
            
            fetch(`${API_BASE_URL}/applications/user`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(applications => {
                const content = `
                    <h1>My Applications</h1>
                    
                    ${applications.length === 0 ? 
                        '<p>You have no applications yet. <a href="#" onclick="loadAllSchemes()">Browse schemes</a> to apply.</p>' : 
                        `
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Scheme</th>
                                        <th>Applied On</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${applications.map(app => `
                                        <tr>
                                            <td>${app.schemeId?.name || 'Scheme'}</td>
                                            <td>${new Date(app.appliedAt).toLocaleDateString()}</td>
                                            <td><span class="application-status status-${app.status}">${app.status}</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-info" onclick="viewApplication('${app.id}')">View</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        `
                    }
                `;
                
                document.getElementById('main-content').innerHTML = content;
            })
            .catch(error => {
                console.error('Error loading applications:', error);
                document.getElementById('main-content').innerHTML = `
                    <div class="alert alert-danger">Error loading your applications. Please try again later.</div>
                `;
            });
        }
        
        function viewApplication(applicationId) {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login to view application details');
                showLoginModal();
                return;
            }
            
            fetch(`${API_BASE_URL}/applications/${applicationId}`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(application => {
                const content = `
                    <div class="card">
                        <div class="card-body">
                            <h2>Application Details</h2>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <h4>Scheme Information</h4>
                                    <p><strong>Name:</strong> ${application.schemeId?.name || 'N/A'}</p>
                                    <p><strong>Description:</strong> ${application.schemeId?.description || 'N/A'}</p>
                                </div>
                                <div class="col-md-6">
                                    <h4>Application Status</h4>
                                    <p><strong>Status:</strong> <span class="application-status status-${application.status}">${application.status}</span></p>
                                    <p><strong>Applied On:</strong> ${new Date(application.appliedAt).toLocaleString()}</p>
                                    ${application.reviewedAt ? `<p><strong>Reviewed On:</strong> ${new Date(application.reviewedAt).toLocaleString()}</p>` : ''}
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h4>Submitted Documents</h4>
                                <ul>
                                    ${application.documents.map(doc => `
                                        <li>
                                            <a href="${API_BASE_URL}/uploads/${doc.split('/').pop()}" target="_blank">${doc.split('/').pop()}</a>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <div class="mt-4">
                                <h4>Additional Information</h4>
                                <p>${application.answers || 'None provided'}</p>
                            </div>
                            
                            <div class="mt-4">
                                <button class="btn btn-secondary" onclick="loadDashboard()">Back to Dashboard</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('main-content').innerHTML = content;
            })
            .catch(error => {
                console.error('Error loading application:', error);
                document.getElementById('main-content').innerHTML = `
                    <div class="alert alert-danger">Error loading application details. Please try again later.</div>
                `;
            });
        }
        
        function loadAdminPanel() {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login to access admin panel');
                showLoginModal();
                return;
            }
            
            // Verify admin role
            const userData = JSON.parse(atob(token.split('.')[1]));
            if (userData.identity.role !== 'admin') {
                alert('Admin access required');
                return;
            }
            
            // Load all applications and schemes
            Promise.all([
                fetch(`${API_BASE_URL}/applications/admin`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                }).then(res => res.json()),
                fetch(`${API_BASE_URL}/schemes`).then(res => res.json())
            ])
            .then(([applications, schemes]) => {
                const content = `
                    <h1>Admin Panel</h1>
                    
                    <ul class="nav nav-tabs" id="adminTabs">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#applications-tab">Applications</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#schemes-tab">Manage Schemes</a>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-3">
                        <div class="tab-pane fade show active" id="applications-tab">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>User</th>
                                            <th>Scheme</th>
                                            <th>Applied On</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${applications.map(app => `
                                            <tr>
                                                <td>${app.userId?.name || 'User'}</td>
                                                <td>${app.schemeId?.name || 'Scheme'}</td>
                                                <td>${new Date(app.appliedAt).toLocaleDateString()}</td>
                                                <td><span class="application-status status-${app.status}">${app.status}</span></td>
                                                <td>
                                                    <div class="btn-group">
                                                        <button class="btn btn-sm btn-info" onclick="viewApplication('${app.id}')">View</button>
                                                        <button class="btn btn-sm btn-success" onclick="updateApplicationStatus('${app.id}', 'approved')">Approve</button>
                                                        <button class="btn btn-sm btn-danger" onclick="updateApplicationStatus('${app.id}', 'rejected')">Reject</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="schemes-tab">
                            <button class="btn btn-primary mb-3" onclick="showAddSchemeModal()">Add New Scheme</button>
                            
                            <div class="row">
                                ${schemes.map(scheme => `
                                    <div class="col-md-6 mb-4">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title">${scheme.name}</h5>
                                                <p class="card-text">${scheme.description.substring(0, 100)}...</p>
                                                <div class="btn-group">
                                                    <button class="btn btn-sm btn-primary" onclick="viewScheme('${scheme.id}')">View</button>
                                                    <button class="btn btn-sm btn-secondary" onclick="editScheme('${scheme.id}')">Edit</button>
                                                    <button class="btn btn-sm btn-danger" onclick="deleteScheme('${scheme.id}')">Delete</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('main-content').innerHTML = content;
            })
            .catch(error => {
                console.error('Error loading admin data:', error);
                document.getElementById('main-content').innerHTML = `
                    <div class="alert alert-danger">Error loading admin panel. Please try again later.</div>
                `;
            });
        }
        
        function updateApplicationStatus(applicationId, status) {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login to perform this action');
                showLoginModal();
                return;
            }
            
            if (!confirm(`Are you sure you want to ${status} this application?`)) {
                return;
            }
            
            fetch(`${API_BASE_URL}/applications/${applicationId}/status`, {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ status })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to update application status');
                }
                return response.json();
            })
            .then(data => {
                alert('Application status updated successfully!');
                loadAdminPanel();
            })
            .catch(error => {
                console.error('Error updating application status:', error);
                alert('Error updating application status. Please try again.');
            });
        }
        
        function showAddSchemeModal() {
            document.getElementById('add-scheme-form').reset();
            addSchemeModal.show();
        }
        
        function handleAddScheme(e) {
            e.preventDefault();
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login to add schemes');
                showLoginModal();
                return;
            }
            
            const name = document.getElementById('scheme-name').value;
            const description = document.getElementById('scheme-description').value;
            const eligibility = document.getElementById('scheme-eligibility').value.split('\n').filter(line => line.trim());
            const benefits = document.getElementById('scheme-benefits').value.split('\n').filter(line => line.trim());
            const documents = document.getElementById('scheme-documents').value.split('\n').filter(line => line.trim());
            const link = document.getElementById('scheme-link').value;
            
            fetch(`${API_BASE_URL}/schemes`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name,
                    description,
                    eligibility,
                    benefits,
                    documentsRequired: documents,
                    link
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to add scheme');
                }
                return response.json();
            })
            .then(data => {
                addSchemeModal.hide();
                alert('Scheme added successfully!');
                loadAdminPanel();
            })
            .catch(error => {
                console.error('Error adding scheme:', error);
                alert('Error adding scheme. Please try again.');
            });
        }
        
        function editScheme(schemeId) {
            // Implementation would be similar to addScheme but with a PATCH request
            alert('Edit functionality would be implemented here');
        }
        
        function deleteScheme(schemeId) {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('Please login to delete schemes');
                showLoginModal();
                return;
            }
            
            if (!confirm('Are you sure you want to delete this scheme? This action cannot be undone.')) {
                return;
            }
            
            fetch(`${API_BASE_URL}/schemes/${schemeId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to delete scheme');
                }
                return response.json();
            })
            .then(data => {
                alert('Scheme deleted successfully!');
                loadAdminPanel();
            })
            .catch(error => {
                console.error('Error deleting scheme:', error);
                alert('Error deleting scheme. Please try again.');
            });
        }
    </script>
</body>
</html>